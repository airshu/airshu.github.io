---
layout: post
title: ctypes模块
category: Python
tags: Python 
keywords: Python tushare
description: 
---


ctypes 是 Python 的外部函数库。它提供了与 C 兼容的数据类型，并允许调用 DLL 或共享库中的函数。可使用该模块以纯 Python 形式对这些库进行封装。


## Hello World

1. 编写C文件
2. 编译C文件
3. 编写Python文件、测试

### 1. 编写C文件

```C
#include <stdio.h>

int hello(const char* name) {
    printf("~~~hello %s ! \n", name);
    return 0;
}

```
### 2. 编译C文件

不同平台生成不同格式的动态库，windows下为dll，linux下为so

> gcc -fPIC -shared hello_module.c -o hello_module.dylib

### 3. 编写Python文件

```Python

import ctypes
from ctypes import c_char_p

lib = ctypes.cdll.LoadLibrary("hello_module.dylib")
lib.hello(c_char_p(bytes("world", "utf-8")))
```


### 类型映射关系

| ctypes       | C 类型                                   | Python类型            |  
| ------------ | -------------------------------------- | ----------------- | 
| c_bool       | _Bool                                  | bool (1)          |
| c_char       | char                                   | 单字符字节对象    |
| c_wchar      | wchar_t                                | 单字符字符串      |
| c_byte       | char                                   | int               |
| c_ubyte      | unsigned char                          | int               |
| c_short      | short                                  | int               |
| c_ushort     | unsigned short                         | int               |
| c_int        | int                                    | int               |
| c_uint       | unsigned int                           | int               |
| c_long       | long                                   | int               |
| c_ulong      | unsigned long                          | int               |
| c_longlong   | __int64 或 long long                   | int               |
| c_ulonglong  | unsigned __int64 或 unsigned long long | int               |
| c_size_t     | size_t                                 | int               |
| c_ssize_t    | ssize_t 或 Py_ssize_t                  | int               |
| c_float      | float                                  | float             |
| c_double     | double                                 | float             |
| c_longdouble | long double                            | float             |
| c_char_p     | char * (NUL terminated)                | 字节串对象或 None |
| c_wchar_p    | wchar_t * (NUL terminated)             | 字符串或 None     |
| c_void_p     | void *                                 | int 或 None       |




## 参考

- [http://icejoywoo.github.io/2018/12/10/intro-python-ctyps.html](http://icejoywoo.github.io/2018/12/10/intro-python-ctyps.html)
- [https://anribras.github.io/tech/2019/01/03/python-ctypes%E6%80%BB%E7%BB%93/](https://anribras.github.io/tech/2019/01/03/python-ctypes%E6%80%BB%E7%BB%93/)
