---
layout: post
title: 后端开发注意事项
category: 后端
tags: PHP
keywords: 
description: 
---


## 下载源码

[源码地址](/2018/06/13/后端代码地址.html)
    
    
## 搭建环境

1、安装相关软件，需要同时安装PHP7.0和PHP5.6
    
    安装php、nginx
    sudo apt-get install nginx 
    sudo apt-get install -y php
    sudo apt-get install -y php7.0-curl
    sudo apt-get install -y php7.0-mysql


    添加源，安装PHP5.6
    sudo add-apt-repository ppa:ondrej/php
    sudo apt-get update
    sudo apt-get install -y php5.6-common php5.6-mbstring php5.6-mcrypt php5.6-mysql php5.6-xml php5.6-gd php5.6-curl php5.6-json php5.6-fpm php5.6-zip php5.6-mcrypt libapache2-mod-php5.6

    切换版本
    sudo update-alternatives --set php /usr/bin/php7.0

    安装PHP扩展memcached
    sudo apt-get install memcached
    sudo apt-get install php5.6-memcached

    安装redis
    apt-get install redis-server
    apt-get install redis-tools
    
    
    安装MySQL
    sudo apt-get install mysql-server mysql-client


    配置后重新装载配置
    service nginx reload

2、添加配置文件

    配置方式可以使用ip，也可以使用sock

    使用sock的方式
    1、设置nginx的conf文件
    fastcgi_pass unix:/run/php/php5.6-fpm.sock;
    2、设置php-fpm的www.conf文件
    listen=/run/php/php5.6-fpm.sock

    使用ip的方式
    1、设置nginx的conf文件
    fastcgi_pass 127.0.0.1:9000;
    2、设置php-fpm的www.conf文件
    cd /etc/php/5.6/fpm/pool.d/
    vim www.conf
    添加listen=127.0.0.1:9000

    添加软链，将nginx目录链接到源码路径
    ln -ls /mnt/hgfs/aipai /opt/htdocs2
    ln -s /mnt/hgfs/aipai /opt/htdocs2

    sudo systemctl status php7.0-fpm.service
    sudo systemctl start php7.0-fpm.service
    
3、配置不同模块的conf文件
    
[aipai.conf](/public/files/aipai.conf)<br />
[aipaimessage.conf](/public/files/aipaimessage.conf)<br />
[convertcenter.conf](/public/files/convertcenter.conf)<br />
[paidashi.conf](/public/files/paidashi.conf)<br />
[paycenter.conf](/public/files/paycenter.conf)<br />
[usercenter.conf](/public/files/usercenter.conf)<br />
[videocenter.conf](/public/files/videocenter.conf)<br />
[webcenter.conf](/public/files/webcenter.conf)<br />

[deliverbackadmin.aipai.com.conf](/public/files/deliverbackadmin.aipai.com.conf)<br />
[deliverbackadmin.bus.aipai.com.conf](/public/files/deliverbackadmin.bus.aipai.com.conf)<br />
[deliverbackadminstatic.aipai.com.conf](/public/files/deliverbackadminstatic.aipai.com.conf)<br />
[videocenterbackadmin.aipai.com.conf](/public/files/videocenterbackadmin.aipai.com.conf)<br />
[videocenterbackadmin.bus.aipai.com.conf](/public/files/videocenterbackadmin.bus.aipai.com.conf)<br />
[videocenterbackadminstatic.aipai.com.conf](/public/files/videocenterbackadminstatic.aipai.com.conf)<br />

[AipaiNg](/public/files/ng.aipai.com)
[AipaiNgBus](/public/files/aipai-ng.bus.aipai.com)




4、配置hosts

[host配置地址](/2018/06/13/hosts配置.html)


## 其他注意事项

- 调试代码的参数（参考代码中一些调试信息的判断条件）
    
    清楚模板缓存
    cleanCacheController=1 
    
    清理缓存(redis等)
    cache=no&ddg=test 
    
- 注意tmp文件夹是否有缓存文件

    
- 新修改的业务代码，测试通过上线后，一定要记得在gitlab上提交Merge Requests，merge到主分支。外网环境使用master分支进行部署。

    [协作分支工作流程](http://developer.aipai.com/docs/server/git)

    
- command对应的写一个shell启动脚本，添加相关注释，并添加描述信息(时间间隔)。

- 如何找到代码部署的机器：打开walle提交上线单，发布机器的IP地址既是。
    
- 代码中数据库配置使用域名的方式，hosts中指向不同的IP地址。

    

    

