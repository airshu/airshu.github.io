---
title: 打包
toc: true
tags: Flutter
---


下载证书，本地安装到钥匙链中

配置Xcode




## 打包命令


### 修改项目的版本号和构建次数

若要使pubspec.yaml文件中的version生效，需要修改Android、iOS项目的配置文件。

#### Android项目配置文件修改

确认android/app/build.gradle文件中使用了Flutter的versionCode和versionName

```
def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader ->
        localProperties.load(reader)
    }
}

def flutterRoot = localProperties.getProperty('flutter.sdk')
if (flutterRoot == null) {
    throw new FileNotFoundException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")
}

def flutterVersionCode = localProperties.getProperty('flutter.versionCode')
if (flutterVersionCode == null) {
    flutterVersionCode = '1'
}

def flutterVersionName = localProperties.getProperty('flutter.versionName')
if (flutterVersionName == null) {
    flutterVersionName = '1.0'
}

android {
    compileSdkVersion 31

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    defaultConfig {
        applicationId "com.xiaopeng.scepter"
        minSdkVersion 21
        targetSdkVersion 31
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
    }
}
```

#### iOS项目

ios/Runner/Info.plist文件中使用Flutter的变量，使用$(FLUTTER_BUILD_NAME)和$(FLUTTER_BUILD_NUMBER)。

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    ...
    <key>CFBundleShortVersionString</key>
    <string>$(FLUTTER_BUILD_NAME)</string>
    <key>CFBundleVersion</key>
    <string>$(FLUTTER_BUILD_NUMBER)</string>
    ...
</dict>
</plist>
```
#### 构建脚本设置版本

```shell

# 设置版本号、设置构建次数
flutter build apk --build-name=1.1.1 --build-number=3
```


## 包体积优化

```shell
# --analyze-size参数用于生成*-code-size-analysis_*.json文件，该文件可以导入到devtools中进行分析包组成
flutter build xx  --analyze-size

# 打开devtools
flutter pub global run devtools
```

### 优化方法

#### 使用obfuscate参数

obfuscate参数会对应用进行混淆，split-debug-info参数配置符号表输出路径，用于后续解析。

```shell

flutter build apk --obfuscate --split-debug-info=/<project-name>/<directory>
```

### 参考

- [https://flutter.cn/docs/perf/app-size](https://flutter.cn/docs/perf/app-size)
- [https://flutter.cn/docs/deployment/obfuscate](https://flutter.cn/docs/deployment/obfuscate)
- [Flutter 2.0 iOS包大小优化](https://dywane.github.io/Flutter-2.0-iOS%E5%8C%85%E5%A4%A7%E5%B0%8F%E4%BC%98%E5%8C%96/)
- [手把手教你分离flutter ios编译产物-附工具](https://juejin.cn/post/6844904078154137608)