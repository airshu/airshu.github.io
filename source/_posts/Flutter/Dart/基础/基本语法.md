---
title: 基本语法
toc: true
tags: Dart
---

## 语言特性

- 一切皆对象。
- Dart没有 public、protected、private 等关键字，如果一个标识符以 _开头则表示私有。
- 标识符以小写字母或下划线_开头，后面跟着字符和数字的任意组合。


## 变量

变量是一个引用,未初始化的变量值是null。

### var

声明的变量在赋值的那一刻，决定了它是什么类型。

```dart
//a已经确定为num，不能再赋值字符串，编译错误
var a = 1;
a = "a";
//正确 
var b;
b = 1;
b = "a";
```


### dynamic

不是在编译时候确定实际类型的, 而是在运行时。dynamic声明的变量行为与Object一样，使用一样，关键在于运行时原理不同。

没有初始化的变量自动获取一个默认值为 `null`（类型为数字的变量如何没有初始化其值也是 null）。

在声明变量的时候，也可以选择加上具体 类型：int a = 1;

### const、final


final是运行时常量，只能被设置一次，而const是编译器常量，它的值在编译期就可以确定，编译时常量能够让代码运行的更高效。

```dart
//正确，已经确定的值
const a = 1;
const b = a + 1;
//错误,final不能在编译时确定值，因此const也不能确定值
final a = 1;
const c = a + 1;
```

## 数据类型

内置类型：

- 数据类型：num
- 字符串类型：String
- 布尔类型：bool
- 列表类型：list
- 集合类型：Set
- 映射类型：Map
- Unicode：Runes
- 标识符：Symbols

### numbers

Dart 中数字类型用于表示数字文字，Dart 中的数字类型分为整数和双精度数两种，整数值不大于64位， 具体取决于平台。

```dart

int i = 11111;
double d = 123123123;
```

### strings

Dart 字符串是 UTF-16 编码的字符序列。 可以使用单引号或者双引号来创建字符串，单引号和双引号可以嵌套使用，否则需要使用`\`进行转义。字符串中也可以引用变量与表达式。

```dart
var name = 'zhangsan';
//如果插入一个简单的标识符，而后面没有紧跟更多的字母数字文本，那么{}应该被省略。
var a = "my name is $name!";
var b = "my name is ${name.toUpperCase()}!";

var a  = "my name is " "zhangsan";

//使用三个单引号或者双引号可以创建多行字符串对象
var s1 = '''
You can create
multi-line strings like this one.
''';

var s2 = """This is also a
multi-line string.""";

//提供一个 `r` 前缀可以创建一个 “原始 raw” 字符串
print(r"换行符：\n"); // 换行符：\n  r:不需要转义
print("换行符：\\n"); // 换行符：\n

```

### 布尔类型

有一个名字为 `bool` 的类型。 只有两个对象是布尔类型的：`true` 和 `false`

### 列表类型

常用属性：

- length：返回当前List的长度。
- isEmpty：判断是否为空，返回bool类型的值。
- isNotEmpty：判断是否为不空，返回bool类型的值。
- reversed：倒序输出List中的值。输出结果并不是一个List，需要使用toList()方法将其在转换成List。

常用方法：

- add(VALUE)：向List中添加单个数据。
- addAll([ARRAY])：以数组的形式向List中添加多个数据。
- indexOf(ELEMENT)：查找ELEMENT是否在List中。如果存在，返回其索引值；如果是不存在，返回 -1。
- remove(ELEMENT)：删除ELEMENT。
- removeAt(INDEX)：删除索引值为INDEX的值。
- fillRange(START,END,[<E> VALUE])：将[START,END）范围内的值改为[<E>VALUE]的值。
- insert(INDEX,VALUE)：在INDEX处插入VALUE。
- insert(INDEX,LIST)：在INDEX处插入LIST。
- join(SYMBOL)：以SYMBOL将LIST隔开，并以String类型返回。
- STRING.split(SYMBOL)：将字符串以SYMBOL进行切割，并以List类型返回。


```dart
var list = [1, 2, 3];
//Lists 的下标索引从 0 开始，第一个元素的索引是 0. list.length - 1 是最后一个元素的索引
print(list[list.length-1]);
//修改元素
list[0] = 2;

//使用new（实际上new可以省去）
var list = new List(1);
list[0] = 2;

//在 list 字面量之前添加 const 关键字，可以定义一个不变的 list 对象（编译时常量）
var list =  const [1,2,3];
i.add(2); ///错误，list不可变

List<int> list2 = const [1,2,3];
// error
// list2.add(5);
list2 = [1,2,3,4];
print(list2);

const List<int> list3 = [4,5,6];
// list3.add(7);
// error
// list3 = [1,2,3,4];
print(list3);
```


### 映射集合类型

键值对相关的对象。 键和值可以是任何类型的对象。每个键只出现一次， 而一个值则可以出现多次。

```dart
//直接声明，用{}表示，里面写key和value，每组键值对中间用逗号隔开
var companys = {'a': '阿里巴巴', 't': '腾讯', 'b': '百度'};
var companys2 = new Map();
companys2['a'] = '阿里巴巴';
companys2['t'] = '腾讯';
companys2['b'] = '百度';

//添加元素
companys['j'] = '京东';
//获取与修改元素
var c = companys['c']; ///没有对应的key返回null
companys['a'] = 'alibaba'; 

```

### Set

```dart
Set<String> set = {'aaa', 'bbb'};
for(var item in set) {
    print(item);
}
set.forEach((element) {
    print(element);
});

//是否包含元素
if (set.contains("aaa")) {
    print("包含元素");
}
set.clear();

```


### runes

用于在字符串中表示Unicode字符。

如果需要获得特殊字符的Unicode编码，或者需要将32位的Unicode编码转换为字符串，就可以借助Runes类。

Dart表达Unicode代码点的常用方法是\uXXXX，其中XXXX是4位十六进制值。要指定多于或少于4个十六进制数字，需要将值放在大括号中。

```dart
var clapping = '\u{1f44f}'; ///5个16进制 需要使用{}
print(clapping);//
//获得 16位代码单元
print(clapping.codeUnits); //[55357, 56399]
//获得unicode代码
print(clapping.runes.toList()); //[128079]

//fromCharCode 根据字符码创建字符串
print( String.fromCharCode(128079));
print( String.fromCharCodes(clapping.runes));
print( String.fromCharCodes([55357, 56399]));
print( String.fromCharCode(0x1f44f));

Runes input = new Runes(
  '\u2665  \u{1f605}  \u{1f60e}  \u{1f47b}  \u{1f596}  \u{1f44d}');
print(String.fromCharCodes(input));
```

### symbols

操作符标识符，可以看作C中的宏。表示编译时的一个常量

```dart
var i = #A; //常量

main() {
  print(i);
  switch(i){
    case #A:
      print("A");
      break;
    case #B:
      print("B");
      break;

  }
  var b = Symbol("b");
  print(#b == b); ///true
}
```

## 函数

在Dart中，函数也是对象，类型为Function。意味着，函数可以赋值给变量，也可以作为其他函数的参数。

在Java中，要实现回调，需要实现一个接口，在Dart中，只需要传递一个回调函数即可。

```dart
void setListener(Function listener){
    listener("Success");
}
//或者
void setListener(void listener(String result)){
    listener("Success");
}

//第三种：类型定义 将返回值为voide，参数为一个String的方法定义为一个类型。
typedef  void Listener(String result)；
void setListener(Listener listener){
  listener("Success");
}

```

```dart
//也可以选择忽略返回类型(不推荐)
int add(int i,int j) {
  return i + j;
}


//对于只有一个表达式的方法，可以选择使用缩写语法来定义：
add(i, j) => i + j;
//在箭头 (=>) 和分号 (;) 之间只能使用一个表达式

```

### 构造函数

```dart


```

#### 默认构造函数


如果未声明构造函数，则会提供默认构造函数。 默认构造函数没有参数，并调用父类无参数构造函数。

默认情况下，子类中的构造函数调用父类的未命名无参数构造函数。 父类的构造函数在子类构造函数体的开头被调用。 如果还使用初始化了列表，则会在调用父类构造函数之前执行。 

执行顺序如下：

- 初始化列表
- 父类的无参数构造函数
- 子类的无参数构造函数


```dart
class Parent{
  Parent(){
    print('In Parent\'s constructor.');
  }
}

class Child extends Parent{
  Child(){
    print('In Child\'s constructor.');
  }
}
```


如果父类没有未命名的无参数构造函数，则必须手动调用父类中的一个构造函数。 在子类的构造函数体之后用冒号(:)指定父类构造函数

```dart
class Parent{
  num x;
  num y;
  Parent(this.x, this.y){
    print('In Parent\'s constructor.');
  }
}

class Child extends Parent{
  Child(num x, num y) : super(x, y){
    print('In Child\'s constructor.');
  }
}
```

#### 命名构造函数

```dart

class Point{
num x;
num y;

Point(this.x, this.y);

//创建一个坐标原点类
Point.origin(){
  this.x = 0;
  this.y = 0;
}

//创建一个坐标为(100, 100)的类
Point.coordinate100(){
  this.x = 100;
  this.y = 100;
}
@override
String toString() {
  return ("x: $x, y: $y");
}
}

```

#### 重定向构造函数

```dart

class Point {
  num x, y;

  //类的主构造函数
  Point(this.x, this.y);

  //重定向到主构造函数
  Point.alongXAxis(num x) : this(x, 0);
}
```

#### 常量构造函数

- 常量构造函数需以const关键字修饰
- const构造函数必须用于成员变量都是final的类
- 构建常量实例必须使用定义的常量构造函数
- 如果实例化时不加const修饰符，即使调用的是常量构造函数，实例化的对象也不是常量实例

```dart


class ImutablePoint {
  final int x;
  final int y;

  //常量构造方法
  const ImutablePoint(this.x, this.y);
}

main() {

var ip1 = const ImutablePoint(1, 1);
var ip2 = const ImutablePoint(1, 1);
var ip3 = const ImutablePoint(1, 2);
print(ip1.hashCode == ip2.hashCode);
print(ip1 == ip2);
print(ip1.hashCode == ip3.hashCode);
print(ip1 == ip3);


output:
true
true
false
false
}




```

#### 工厂构造函数

```dart

class CommonPrivacyScreen {
  final String title;
  final String url;

  factory CommonPrivacyScreen.privacy() {
    return CommonPrivacyScreen(title: "title_privacy",url: "url_privacy");
  }

  factory CommonPrivacyScreen.agreement() {
    return CommonPrivacyScreen(title: "title_agreement",url: "title_agreement");
  }

  CommonPrivacyScreen({Key key, this.title, this.url}) : super(key: key);
}

```


### 可选参数

#### 可选命名参数

把方法的参数放到 `{}` 中就变成可选命名参数

```dart
int add({int? i, int? j}) {
  if(i == null || j == null){
    return 0;
  }
  return i + j;
}
print(add());
print(add(i: 1));
print(add(i: 2, j: 4));
```

#### 可选位置参数

把方法的参数放到 `[]` 中就变成可选位置参数，传值时按照参数位置顺序传递。

```dart
class SquareBracketsClass {
  late int x;
  late int y;
  // 1、2为默认参数
  SquareBracketsClass([int x=1, int y=2]) {
    this.x = x;
    this.y = y;
  }
}
main() {
  var squareBracketClass = SquareBracketsClass(3);
  var squareBracketClass2 = SquareBracketsClass(3, 6);
}
```



### 函数作为参数传递

```dart



```

### 匿名函数

```dart
([Type] param1, …) { 
  codeBlock; 
}; 

var list = ['1', '2', '3', '4', '5'];
list.forEach((i) {
  print(list[i]);
});


```

变量作用域
变量闭包
函数返回值


## 操作符


### 类型判定操作符

`as`、 `is`、 和 `is!` 操作符是在运行时判定对象 类型的操作符

| 操作符 | 解释                           |
| ------ | ------------------------------ |
| `as`   | 类型转换                       |
| `is`   | 如果对象是指定的类型返回 True  |
| `is!`  | 如果对象是指定的类型返回 False |

`as` 操作符把对象转换为特定的类型，但是如果无法完成转换则会抛出一个异常

`is` 和Java中的 `instanceof` 相同


### 赋值操作符


```dart
b ??= value; // 如果 b 是 null，则 value 赋值给 b；
             // 如果不是 null，则 b 的值保持不变
```


### 条件表达式

```dart

- `condition ? expr1 : expr2`

  如果 *condition* 是 true，执行 *expr1* (并返回执行的结果)； 否则执行 *expr2* 并返回其结果。

- `expr1 ?? expr2`

  如果 *expr1* 不为null，返回其值； 否则执行 *expr2* 并返回其结果。


```

### 级联操作符

可以实现链式调用。

```dart
//StringBuffer write就是Java的append
var sb = new StringBuffer();
sb..write('foo')..write('bar');

```

### 安全操作符

```dart
String sb;
//空指针
print(sb.length);
print(sb?.length);
```


## 参考

- [Flutter:6种构造函数详解](https://www.codenong.com/jsed0a25181873/)
