---
title: 基础知识
tags: React Native 
---

facebook先开源了React，然后基于React，开源了可以在App上用的React Native。先了解一下React[React 入门实例教程](http://www.ruanyifeng.com/blog/2015/03/react.html)


React是一个JavaScript库，用于简单的创建用户界面；React Native则可以用于手机Android、iOS应用。

开发React需要引入：

- react.js：核心库
- react-dom.js：与DOM相关
- browser.min.js：将JSX转为JavaScript语法


## 组件的生命周期

![](./component-lifecycle.jpg)

- mounting:已插入真实DOM
- updating:正在被重新渲染
- unmounting:已移出真实DOM

React为每个状态提供了两种处理函数，will函数载进入状态之前调用，did函数在进入状态之后调用

```JavaScript
componentWillMount()
componentDidMount()
componentWillUpdate(object nextProps, object nextState)
componentDidUpdate(object prevProps, object prevState)
componentWillUnmount()

//特殊状态的处理函数
componentWillReceiveProps(object nextProps)：已加载组件收到新的参数时调用
shouldComponentUpdate(object nextProps, object nextState)：组件判断是否重新渲染时调用
```


## 专有名词

![](./framework.png)

- React：纯JS框架，用 JS 实现了 Virtual Dom, 实现了数据驱动编程的模式, 而且 React 还提出了独特的 JSX 语法, 实现了在 JS 就可以写 HTML 和 CSS 代码, 配合虚拟 DOM 就实现了基于 MVC 的前端框架
- Babel:Babel 是一个高度可配置的编译器，它允许我们使用较新的 JavaScript 语言功能（以及扩展，如 JSX），将“向下”编译为更广泛的引擎支持的较旧版本的 JavaScript
- React Native：JavaScript Core + React.js + Bridges
- JavaScriptCore：JS引擎，用来解释和执行JavaScript代码。在React Native中，负责bundle产出的JS代码的解析和执行
- JS Engine：React Native需要一个JS运行环境，RN会把应用的JS代码编译成一个JS文件（x.x.bundle），RN框架的目标就是解释运行这个JS脚本文件，如果是Native扩展的API，则直接通过bridge调用Native方法，最基础的比如绘制UI界面，映射Virtual DOM到真实的UI组件中。
- Hermes Engine：新一代JavaScript引擎，相对于JavaScriptCore和V8引擎，各方面性能显著提升。
- Bridge：
    - RCTRootView：
    - RCTBridge：
        - 加载和初始化专用类, 用于前期 JS 的初始化和原生代码的加载
        - 负责加载各个 Bridge 模块供 JS 调用
        - 找到并注册实现了 RCTBridgeModule protocol 的类
        - 创建持有 RCTBatchedBridge
    - RCTBatchedBridge：负责 Native 和 JS 之间的相互调用, 也就是信息通信
    - RCTJavaScriptLoader：实现远程代码的核心, 热更新, 开发环境代码加载. 静态 jsbundle 加载
    - RCTContextExecutor：封装了 JS 和 Native 代码的互相调用逻辑
    - RCTModuleData：加载管理所有与 JS 交互的原生代码, 把交互代码封装成 JS 模块
    - RCTModuleMethod：
        - 记录所有原生代码的导出函数地址, 同时生成对应的字符串映射到改函数地址
        - 翻译所有 J2N call
    - MessageQueue：

- metro：facebook官方推出的打包工具
- JSI：JavaScript Interface，JSI 是一个轻量级的通用的 API 框架，可以应用于任意的 JavaScript virtual machine
- fabric：UI Manager新名称，整个框架中新UI层
- codepush：用于热更新

![](./framework1.webp)

- JS Thread：读取和编译所有JavaScript代码
- UI Thread：原生渲染和调用
- Shadow Thread：通过Yoga引擎计算布局，将结果发送给Native UI





## 常用的API

- ReactContext：继承于ContextWrapper，是React Native应用的上下文，管理着CatalystInstance以及三大线程（UIThread、NativeModulesThread、JSThread）
    - ReactApplicationContext: ReactContext的子类 
    - ThemedReactContext：
- ReactInstanceManager：总的管理类，管理ReactPackage、ReactContext、ReactRootView、控制生命周期，同时还可以设置JavaScript引擎
- ReactRootView：React Native渲染的原生容器，继承于FrameLayout
- CatalystInstance：Java层、C++层、JavaScript层通信的总管理类，管理着Java层、JavaScript层Module映射表与回调，是三端通信的桥梁。实现类为CatalystInstanceImpl，支持向JavaScript注入全局变量、动态加载脚本文件、获取NativeModules & JSModules
- ReactBridge：通信桥，三端通信的桥梁
- JavaScriptModule：JS Module，负责JavaScript到Java的映射调用格式生命，由CatalystInstance统一管理
- NativeModule：Java Module，负责Java到JavaScript的映射调用格式声明，由CatalystInstance统一管理
- JavaScriptModuleRegistry:JavaScriptModule注册表，负责管理与查找JavaScriptModule
- JSCExecutor.cpp: 脚本引擎，封装了Webkit的JavaScriptCore
- UIManager：处理UI的渲染，JavaScript层通过C++层把创建的View的请求发送给Java层的UIManagerModule
- Android常用API：
    - ReactRootView：容器视图，需要setContentView
    - ReactPackage: 一个js bundle的信息，需要注册到ReactInstanceManager
    - ReactContextBaseJavaModule: 一个package对应一个module，里面会实现native的方法给js用
    - ReactInstanceManager：总管理类，创建ReactContext、CatalystInstance，解析ReactPackage，配合ReactRootView管理View的创建与生命周期
    - ReactNativeHost：包含ReactInstanceManager，方便用户使用，一般要实现getPackages方法返回所有bundle
    - ReactActivity：封装好的Activity，方便使用
    - ReactFragment：
    - ReactActivityDelegate：委托类，可以实现各种回调
    - ReactDelegate：ReactActivityDelegate的成员变量
    - ReactApplication：如果使用ReactActivity，则Application需要实现这个接口，将package进行注册
    - MainReactPackage: 包含默认支持的package，对应modules文件夹，比如toast、storeage等等，可以直接在js端使用
    - 常用Modules：
        - AppearanceModule：
        - CameraRollManager：允许JS访问相机和摄像头
        - ClipboardModule：剪切板操作
        - DatePickerDialogModule：原生日期选择
        - DeviceInfoModule：设备信息
        - DialogModule：显示原生弹窗
        - NetworkingModule：网络访问
        - PermissionsModule：权限管理
        - ShareModule：系统分享
        - StatusBarModule：状态栏设置
        - AsyncStorageModule：存储键值对
        - AndroidInfoModule：获取Android的一些常量信息，比如厂商、版本信息等
        - ToastModule：原生toast




## 常用命令

- npm
- npx
- yarn


## JSX




## ES6特性

class

module

export

import



Named imports and exports

Import from modules



## 参考

- [React Native 原理与实践](https://juejin.cn/post/6916452544956858382)
- [https://github.com/sucese/react-native](https://github.com/sucese/react-native)
- [https://www.reactnative.express/](https://www.reactnative.express/)