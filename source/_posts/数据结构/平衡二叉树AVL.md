---
title: 数据结构（平衡二叉树AVL）
tags: 算法 数据结构
---

## 定义

平衡二叉树也叫自平衡二叉搜索树（Self-Balancing Binary Search Tree），所以其本质也是一颗二叉搜索树。在AVL树中，任一节点对应的两棵子树的最大高度差为1，因此它也被称为**高度平衡树**。节点的**平衡因子**是它的左子树的高度减去它的右子树的高度（有时相反）。带有平衡因子1、0或 -1的节点被认为是平衡的。带有平衡因子 -2或2的节点被认为是不平衡的，并需要重新平衡这个树（**旋转操作**）。


最小失衡子树：在新插入的结点向上查找，以第一个平衡因子的绝对值超过1的结点为根的子树称为最小不平衡子树。也就是说，一棵失衡的树，是有可能有多棵子树同时失衡的。而这个时候，我们只要调整最小的不平衡子树，就能够将不平衡的树调整为平衡的树。Ï

平衡二叉树的失衡调整主要是通过旋转最小失衡子树来实现的。根据旋转的方向有两种处理方式，**左旋**与**右旋**。

旋转的目的就是减少高度，通过降低整棵树的高度来平衡。哪边的树高，就把那边的树向上旋转。

**左旋**

1. 节点的右孩子替代此节点位置 
2. 右孩子的左子树变为该节点的右子树 
3. 节点本身变为右孩子的左子树

**右旋**

1. 节点的左孩子代表此节点 
2. 节点的左孩子的右子树变为节点的左子树 
3. 将此节点作为左孩子节点的右子树。



## AVL树的四种插入节点方式


平衡二叉树插入节点的情况分为以下四种：

| 插入方式 | 描述 | 旋转方式 | 
| -------- | ------------------ | ------------ | 
| LL | 在 A 的左子树根节点的左子树上插入节点而破坏平衡 | 右旋转 | 
| RR | 在 A 的右子树根节点的右子树上插入节点而破坏平衡 | 左旋转 | 
| LR | 在A的左子树根节点的右子树上插入节点而破坏平衡 | 先左旋后右旋 | 
| RL | 在 A 的右子树根节点的左子树上插入节点而破坏平衡 | 先右旋后左旋 |

![](./avl_tree_1.png)

### 详细分析



## 删除


AVL 树和二叉查找树的删除操作情况一致，都分为四种情况：

1. 删除叶子节点 
2. 删除的节点只有左子树 
3. 删除的节点只有右子树 
4. 删除的节点既有左子树又有右子树

只不过AVL树在删除节点后需要重新检查平衡性并修正，同时，删除操作与插入操作后的平衡修正区别在于，插入操作后只需要对插入栈中的弹出的第一个非平衡节点进行修正，而删除操作需要修正栈中的所有非平衡节点。

删除操作的大致步骤如下：

- 以前三种情况为基础尝试删除节点，并将访问节点入栈。
- 如果尝试删除成功，则依次检查栈顶节点的平衡状态，遇到非平衡节点，即进行旋转平衡，直到栈空。
- 如果尝试删除失败，证明是第四种情况。这时先找到被删除节点的右子树最小节点并删除它，将访问节点继续入栈。
- 再依次检查栈顶节点的平衡状态和修正直到栈空。

对于删除操作造成的非平衡状态的修正，可以这样理解：对左或者右子树的删除操作相当于对右或者左子树的插入操作，然后再对应上插入的四种情况选择相应的旋转就好了。

### 详细分析


## 参考

- [https://blog.csdn.net/jyy305/article/details/70949010](https://blog.csdn.net/jyy305/article/details/70949010)
- [https://zhuanlan.zhihu.com/p/56066942](https://zhuanlan.zhihu.com/p/56066942)
- [https://www.cs.usfca.edu/~galles/visualization/AVLtree.html](https://www.cs.usfca.edu/~galles/visualization/AVLtree.html)


