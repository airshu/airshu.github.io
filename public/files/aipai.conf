##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# http://wiki.nginx.org/Pitfalls
# http://wiki.nginx.org/QuickStart
# http://wiki.nginx.org/Configuration
#
# Generally, you will want to move this file somewhere, and start with a clean
# file but keep this around for reference. Or just disable in sites-enabled.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {

	root /opt/htdocs2/svn/server/trunk/nectar;
	#root /var/www/trunk-git/nectar;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.php index.nginx-debian.html;

	server_name aipai.com www.aipai.com *.aipai.com res9.weplay.cn shouyou.bus.aipai.com uploadfile.aipai.com dashi.aipai.com;


	# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
	#
	location ~ \.php$ {
		include snippets/fastcgi-php.conf;
	#
	#	# With php7.0-cgi alone:
	#	fastcgi_pass 127.0.0.1:9000;
	#	# With php7.0-fpm:
	#	fastcgi_pass unix:/run/php/php7.0-fpm.sock;
	#	# With php5.6-fpm:
        fastcgi_buffers 16 16k;
        fastcgi_buffer_size 32k;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
	}

	if ($host ~ "^shouyou.aipai.com$") {
      rewrite ^/(c|p|hd|m)([0-9]+)/(.*\/)?([a-zA-Z0-9\-_]+)(\+[a-zA-Z0-9]+)?\.html$ /app/www/shouyou/index.php?q=$1$2/$3$4 last;
      rewrite (.*)\.(html|css|js|jpg|png|gif|ico|swf|xml|rar|mp3|MP3|bmp)(.*) /$1.$2$3 break;
      rewrite ^/(.*)$ /app/www/shouyou/index.php?q=$1 last;
    }

    if ($host ~ "^shouyou.bus.aipai.com$") {
        rewrite ^/(.*?)$ /bus/$1 last;
    }
    if ( $host ~ "^m.aipai.com$") {
        rewrite ^/mobile/zt/(.*?)_(.*)\.html  /app/www/mobile/zt/$1.php?html=$2 last;
        rewrite ^/$ /app/www/mobile/index.php last;
    }
    if ($host ~ "^home.aipai.com$"){
        rewrite ^/([0-9]+)$ /app/www/space.php?bid=$1 last;
    }
    if ( $host ~ "^bus.aipai.com$" ) {
       #rewrite ^/bus/(.*?)$ /bus/$1 last;
    }
    if ($host ~ "^f.aipai.com$") {
	rewrite ^/$ /app/www/bfans.php break;
    }
    if ($host ~ "^www.aipai.com$") {
        rewrite ^/keywords/(.*)\.html$ /app/www/ext/searchTag.php?action=info&tid=$1 break;
        rewrite ^/keywords/$ /app/www/ext/searchTag.php break;
    }
    rewrite /yingshi/(.*)\.html$  /app/www/ext/letv.php?action=player&videoId=$1 last;
    rewrite /(app|bus|user|backadmin|stats|account)/(.+) /$1/$2 last;
    rewrite ^/(c|p|hd|m|x|mp)([0-9]+)/(.*\/)?([a-zA-Z0-9\-_]+)(\+[a-zA-Z0-9]+)?\.html$ /app/www/makecard.php?sid=$2&target=$4&stype=$1 last;
    rewrite ^/bus/comment/(.*?)$ /bus/comment/$1 last;
    rewrite ^/app/www/(.*?)$ /app/www/$1 last;
    rewrite /zt/(\d+)/([^_]+)_(.+)\.html$ /app/www/zt/$1/$2.php?html=$3 last;   
    rewrite /cmsAdmin/cmsAdmin_2013_(.+)\.html$ /app/www/cmsAdmin/cmsAdmin_2013.php?html=$1 last;
    rewrite ^/(zt|templates|api|cmsAdmin|apps|ext|mobile|pay|templates)/(.*?)\.(php|html|swf|css|js|jpg|jpeg|png|gif)(.*?)$ /app/www/$1/$2.$3$4 last;
    rewrite ^/((?!templates).*)\.(html|swf|css|js|jpg|jpeg|png|gif)(.*?)$ /app/www/templates/$1.$2$3 last;
    rewrite ^/(.*?)$ /app/www/$1 ;
    rewrite ^/(book|card|user|avatar|declare|game|search|group|album|event|news|show|dou|paiba|paidashi|member|vip|task|live|mobile)_(.*)\.html$ /app/www/$1.php?html=$2 last;
    rewrite /(.*)/(.*)/playerOut.swf\?(.*)$ /app/www/playerOut.php?target=$2&$3 last;
    rewrite /(.*)/(.*)/playerOut.swf$ /app/www/playerOut.php?target=$2 last;
}

server {
	root /opt/htdocs2/svn/server/trunk/nectar/app/www;
	server_name www1.aipai.com;

    location ~ ^/aipaiApi/ {
        rewrite ^/aipaiApi/(.*?)/(.*?)$ /apps/apps.php?module=$1&func=$2;
    }

    location ~ ^/(.*?)_(.*?)\.html {
        rewrite ^/(.*?)_(.*?)\.html /$1.php?html=$2;
    }

    location ~ ^/app/admin/.*\.php$ {
        root /opt/htdocs2/svn/server/trunk/nectar;
		include snippets/fastcgi-php.conf;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
    }

    location ~ \.(css|js|jpeg|jpg|png|gif|woff|swf)$ {
        root /opt/htdocs2/svn/server/trunk/nectar;
        try_files $uri /app/www$uri /app/www/templates$uri /app/www/templates/aipai_platform/$uri;
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Headers X-Requested-With;
        add_header Access-Control-Allow-Methods GET;
    }

	location ~ \.php$ {
		include snippets/fastcgi-php.conf;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
	}

}

server {
	root /opt/htdocs2/svn/server/trunk/nectar;
	server_name vip.aipai.com home.aipai.com;

    rewrite ^/([0-9]+)$ /app/www/space.php?bid=$1 last;

	location ~ \.php$ {
		include snippets/fastcgi-php.conf;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
	}

}

server {
    root /opt/htdocs2/svn/server/trunk/nectar/app/www;
    server_name www10.aipai.com;

    location ~ ^/aipaiApi/ {
        rewrite ^/aipaiApi/(.*?)/(.*?)$ /apps/apps.php?module=$1&func=$2;
    }

    location ~ ^/(.*?)_(.*?)\.html {
        rewrite ^/(.*?)_(.*?)\.html /$1.php?html=$2;
    }

    location ~ \.(css|js|jpeg|jpg|png|gif|woff|swf)$ {
        root /opt/htdocs2/svn/server/trunk/nectar;
        try_files $uri /app/www$uri /app/www/templates$uri /app/www/templates/aipai_platform/$uri;
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Headers X-Requested-With;
        add_header Access-Control-Allow-Methods GET;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
    }

}

server {
    root /opt/htdocs2/svn/server/trunk/nectar/app/www;
    server_name m.aipai.com;

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
    }
}

server {
    root /opt/htdocs2/svn/server/trunk/nectar;
    server_name gateway.bus.aipai.com;
    index gateway.php;

    location / {
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
    }
}


# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#	listen 80;
#	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
#}
