
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>andengine for android game development读书笔记(一)  </title>
   <meta name="author" content="lsj" />

   <link rel="start" href="/" />

	
	
	
  	<link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/feedname" title="RSS feed" />
	
	

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/assets/themes/mark-reid/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/mark-reid/css/screen.css" type="text/css" />


	
</head>

<body id="">

<div id="header" >
    <h1>
    	<a href="/" title="alonepig's blog" >alonepig's blog</a>
		<!--     	<span class="byline">&larr; <a href="/">lsj</a></span> -->
    </h1>
    <ul class="nav">
      <li><a class="home" href="/">Home</a></li>
      <li><a  href="/archive.html">Archive</a></li>
      <li><a  href="/pages.html">Pages</a></li>
      <li><a  href="/categories.html">Categories</a></li>
      <li><a  href="/tags.html">Tags</a></li>
      <li><a  href="/about.html">About</a></li>
    </ul>
  </div>
</div>

<div id="left">

     <strong>Tag Clound</strong>
     <br />
     <div class="navbar1" >
     	
    		<a href="tags.html#fms-ref" id="1" class="__tag" style="margin: 5px">fms</a>
  		
    		<a href="tags.html#air-ref" id="2" class="__tag" style="margin: 5px">air</a>
  		
    		<a href="tags.html#ios-ref" id="3" class="__tag" style="margin: 5px">ios</a>
  		
    		<a href="tags.html#actionscript-ref" id="4" class="__tag" style="margin: 5px">actionscript</a>
  		
    		<a href="tags.html#error-ref" id="5" class="__tag" style="margin: 5px">error</a>
  		
    		<a href="tags.html#swf-ref" id="6" class="__tag" style="margin: 5px">swf</a>
  		
    		<a href="tags.html#crack-ref" id="7" class="__tag" style="margin: 5px">crack</a>
  		
    		<a href="tags.html#vim-ref" id="8" class="__tag" style="margin: 5px">vim</a>
  		
    		<a href="tags.html#essential actionscript3.0-ref" id="9" class="__tag" style="margin: 5px">essential actionscript3.0</a>
  		
    		<a href="tags.html#p2p-ref" id="10" class="__tag" style="margin: 5px">p2p</a>
  		
    		<a href="tags.html#stock-ref" id="11" class="__tag" style="margin: 5px">stock</a>
  		
    		<a href="tags.html#android-ref" id="12" class="__tag" style="margin: 5px">android</a>
  		
     </div>
     
     
     <strong>Calendar</strong>
      
     <div class="navbar1" >
     <table cellpadding="0" cellspacing="0" id="1" > 
		<tr> 
		<td><style> 
body,td,.p1,.p2,.i{font-family:arial} 
body{margin:0 0 0 0;background-color:#fff;color:#000;} 
table{border:0} 
#cal{width:100%;border:1px solid #c3d9ff;font-size:12px;margin:0px 0 0 0px} 
#cal #top{height:29px;line-height:29px;background:#e7eef8;color:#003784;padding-left:0px} 
#cal #top select{font-size:12px} 
#cal #top input{padding-right: 0px; right: 0px} 
#cal ul#wk{margin:0;padding:0;height:25px} 
#cal ul#wk li{float:left;width:34.5px;text-align:center;line-height:25px;list-style:none} 
#cal ul#wk li b{font-weight:normal;color:#c60b02} 
#cal #cm{clear:left;border-top:1px solid #ddd;border-bottom:1px dotted #ddd;position:relative} 
#cal #cm .cell{position:absolute;width:42px;height:36px;text-align:center;margin:0 0 0 0px} 
#cal #cm .cell .so{font:bold 16px arial;} 
#cal #bm{text-align:right;height:24px;line-height:24px;padding:0 13px 0 0} 
#cal #bm a{color:7977ce} 
#cal #fd{display:none;position:absolute;border:1px solid #dddddf;background:#feffcd;padding:10px;line-height:21px;width:150px} 
#cal #fd b{font-weight:normal;color:#c60a00} 
</style> 
<!--[if IE]> 
<style> 
#cal #top{padding-top:4px} 
#cal #top input{width:65px} 
#cal #fd{width:170px} 
</style> 
<![endif]--> 
		<div id="cal">
			<div id="top">
				<select>
				</select> 年 <select>
				</select> 月 <span></span> [ <span></span>年 ] <input type="button"
					value="今天" title="点击后跳转回今天" style="padding: 0px">
			</div>
			<ul id="wk">
				<li>一</li>
				<li>二</li>
				<li>三</li>
				<li>四</li>
				<li>五</li>
				<li><b>六</b></li>
				<li><b>日</b></li>
			</ul>
			<div id="cm"></div>
			<div id="bm"></div>
		</div>
		</td>
		</tr>
		</table>
     </div>
     
     
<!-- 	<strong>Blogroll</strong><br /> -->
<!-- 	<div class="navbar1" > -->
<!--      	<ul > -->
<!--      		<li><a href="" target="_blank" ><span >github.com</span></a></li> -->
<!--      	</ul> -->
<!-- 	</div> -->
	
	<!--
	<strong>Find Me</strong><br />
	<div class="navbar1" >
	<ul >
          <li><a href="https://github.com/alonepig" target="_blank" title="Github"><span class="fa fa-github fa-lg">Github</span></a></li>
          <li><a href="http://www.douban.com/people/alonepig" target="_blank" title="douban"><span>豆瓣</span></a></li>
          <li><a href="http://www.zhihu.com/people/alonepig" target="_blank" ><span>知乎</span></a></li>
     </ul>
     </div>
     
     -->
</div>


<div id="site">
  
  
<div id="page">
	
  <h1 class="emphnext">andengine for android game development读书笔记(一)</h1>
  <ul class="tag_box inline">
  
  


  
     
    	<li><a href="/tags.html#android-ref">android <span>1</span></a></li>
    
  



  </ul>

  <h4>第一章、AndEngine 游戏引擎架构</h4>

<p><strong>介绍</strong></p>

<p>AndEngine引擎最大的特点是其非常容易构建一个游戏。可能在几个星期内就能完成一款游戏从头到尾的设计和编码，但不代表它会是一款完美的游戏。在使用该引擎前最好先理解该引擎，才能创建出好的已扩展的游戏。</p>

<p>这一章中，我们会先大致了解一下引擎中非常常用的组件。它们是构建游戏的基础。此外，我们将讨论资源和对象类型的不同点，它们在塑造游戏的外观和整体风格中扮演了重要的角色。</p>

<p><strong>生命周期</strong></p>

<p>理解游戏初始化的顺序很重要。基本包括创建引擎、装载游戏资源、设置初始化屏幕和设置。这些都是创建一个AndEngine游戏的基础。但为了让你的游戏更加多样性，你需要明白其生命周期。</p>

<p>参考PacktRecipesActivity</p>

<p>AndEngine生命周期有几个方法直接负责定义。这些方法包括创建引擎属性(EngineOptions)对象，创建场景(Scene)对象，将子实体填充到场景中。这些方法按照下面的顺序调用：</p>

<p>1、定义onCreateEngineOptions()方法：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@Override
public EngineOptions onCreateEngineOptions() {
    // Define our mCamera object
    mCamera = new Camera(0, 0, WIDTH, HEIGHT);
    // Declare &amp; Define our engine options to be applied to our Engine object
    EngineOptions engineOptions = new EngineOptions(true,
    ScreenOrientation.LANDSCAPE_FIXED, new FillResolutionPolicy(), mCamera);
    // It is necessary in a lot of applications to define the following
    // wake lock options in order to disable the device&#39;s display
    // from turning off during gameplay due to inactivity
    engineOptions.setWakeLockOptions(WakeLockOptions.SCREEN_ON);
    // Return the engineOptions object, passing it to the engine
    return engineOptions;
}
</code></pre></div>
<p>2、定义哦那CreateResources()方法：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@override
public void onCreateResource(OnCreateResourcesCallback pOnCreateResourcesCallback){
//装载好所有资源后调用该方法
    pOnCreateResourcesCallback.onCreateResourcesFinished();
}
</code></pre></div>
<p>3、定义onCreateScene()方法：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@override 
public void onCreateScene(OnCreateSceneCallback pOnCreateSceneCallback){
    mScene = new Scene();
    // 通知回调已经完成创建场景
    pOnCreateSceneCallback.onCreateSceneFinished(mScene);
}
</code></pre></div>
<p>4、定义onPopulateScene()方法：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@override 
public void onPopulateScene(Scene pScene, OnPopulateSceneCallback pOnPopulateSceneCallback){
// 完成之后回调此方法
    pOnPopulateSceneCallback.onPopulateSceneFinished();
}
</code></pre></div>
<p>上面的代码是AndEngine游戏的基础。我们建立一个主activity作为我们应用的入口。这个activity包括四个主要的方法，作用分别表示创建EngineOptions属性，创建资源、创建场景和填充场景。</p>

<p>第一步，我们重写了onCreateEngineOptions()方法。在方法里面，初始化了摄像机对象和引擎属性对象。两个对象的构造函数可以传递我们应用的属性。此外，engineOptions.setWakeLockOptions(WakeLockOptions.SCREEN_ON)表示屏幕常亮。</p>

<p>第二步，定义了onCreateResources()方法，它用来创建游戏需要的资源。这些资源包括纹理、声音、音乐和字体。在这一步和接下来的两步，我们需要调用相应的方法以进行回调。对于onCreateResources()，我们必须调用pOnCreateResourcesCallback.onCreateResourcesFinished(),放在方法的最后面。</p>

<p>下面的列表中，我们将生命周期的方法按顺序排列：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">onCreate：这个方法是Android SDK应用入口。在AndEngine开发中，这个方法只是在BaseGameActivity类中简单的调用onCreateEngineOptions()方法。

onResume：另外一个Android方法。在这里，我们从EngineOptions对象获取锁屏属性，然后调用RenderSurfaceView的onResume()方法。

onSurfaceCreated：可能会调用onCreateGame()

onReloadResources：装载资源

onCreateGame：按顺序执行三个回调。

onCreateResources：允许我们声明和定义应用的初始化资源

onPopulateScene：完成设置场景

onGameCreated：表示onCreateGame()队列完成。如有必要重新装载资源，否则什么都不做。

onSurfaceChanged：应用方向发生变化时调用

onResumeGame：启动生命周期最后一个调用的方法。如果启动过程中没有问题，则引擎的start()方法会被调用。
</code></pre></div>
<p>生命周期在最小化和终止时：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">onPause：最小化或终止时第一个被调用的方法。

onPauseGame：然后，AndEngine实现的onPause()灰调用引擎的stop()方法。

onDestroy：清除所有资源

onDestroyResources；这个方法会在onDestroy中被调用。清除音乐和声音。

onGameDestroyed：最后调用，将mGameCreated设置为false。
</code></pre></div>
<p>前面我们介绍了BaseGameActivity类，下面使用其他可以替代它的类，不同的类有稍许不同。</p>

<p>LayoutGameActivity类</p>

<p>这个类可以时原始的Android View添加到游戏中。它的做法就是调用setContentView(layoutID)方法。使用这个类，可以轻松的在游戏中添加广告。</p>

<p>使用LayoutGameActivity类的步骤如下：</p>

<p>1、布局文件中添加以下代码：这个View会显示到游戏当中。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&lt;org.andengine.opengl.view.RenderSurfaceView
android:id=&quot;@+id/gameSurfaceView&quot;
android:layout_width=&quot;fill_parent&quot;
android:layout_height=&quot;fill_parent&quot;/&gt;
</code></pre></div>
<p>2、关联到布局文件，假设步骤1中的布局文件名字是main，重写LayoutGameActivity的方法,这样在onSetContentView中就会找到对应的布局文件了。</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@Override
protected int getLayoutID() {
    return R.layout.main;
}
@Override
protected int getRenderSurfaceViewID() {
    return R.id.gameSurfaceView;
}
</code></pre></div>
<p>SimpleBaseGameActivity和SimpleLayoutGameActivity类</p>

<p>重写了一些生命周期中的方法使其更加容易使用。它们不需要我们重写onPopulateScene()方法，我们也不用回调那些方法了。</p>

<p>SimpleAsyncGameActivity类</p>

<p>这个类包含了三个方法onCreateResourcesAsync()、onCreateSceneAsync()、onPopulateSceneAsync()。主要作用是在加载各种资源时提供一个进度数据。比如：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@Override
public void onCreateResourcesAsync(IProgressListener pProgressListener) throws Exception {
    // Load texture number one
    pProgressListener.onProgressChanged(10);
    // Load texture number two
    pProgressListener.onProgressChanged(20);
    // Load texture number three
    pProgressListener.onProgressChanged(30);
    // We can continue to set progress to whichever value we&#39;d like
    // for each additional step through onCreateResourcesAsync...
}
</code></pre></div>
<p><strong>选择引擎类型</strong></p>

<p>在开始编码之前，先根据游戏所需的性能选择不同的引擎类型。</p>

<p>为了指定合适的Engine对象，我们必须重写onCreateEngine()方法，来设置不同类型的Engine。默认情况如下：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@override 
public Engine onCreateEngine(EngineOptions pEngineOptions){
    return new Engine(pEngineOptions);
}
</code></pre></div>
<p>下面是不同Engine类型的介绍：</p>

<p><em>Engine</em>：对于大部分游戏来说不实用，因为它没有限制每秒的帧率。</p>

<p><em>FixedStepEngine</em>：会以一个固定速度循环刷新游戏，不需要考虑不同设备。如new FixedStepEngine(pEngineOptions, 60)则每秒刷新60次。</p>

<p><em>LimitedFPSEngine</em>：限制最大帧率。</p>

<p><em>SingleSceneSplitScreenEngine和DoubleSceneSplitScreenEngine</em>：允许创建两个分开的摄像机，这样就可以在一个设备中供两个人一起玩游戏。</p>

<p><strong>选择解决策略</strong></p>

<p>在onCreateEngineOptions方法中：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">EngineOptions engineOptions = new EngineOptions(true, ScreenOrientation.LANDSCAPE_FIXED, new FillResolutionPolicy(), mCamera);
</code></pre></div>
<p><em>FillResolutionPolicy</em> ：全屏使用</p>

<p><em>FixedResolutionPolicy</em> ：允许固定应用尺寸。如new FixedResourcePolicy(800， 480)</p>

<p><em>RatioResolutionPolicy</em> ：按比例显示。raito等于高宽比。new RaitoResourcePolicy(1.6f)或new RaitoResourcePolicy(800, 600)</p>

<p><em>RelativeResolutionPolicy</em> ：提供缩放。可以缩放高宽new RelativeResolutionPolicy(1.5f， 0.5f)</p>

<p><strong>创建对象工厂</strong></p>

<p><strong>创建游戏管理器</strong></p>

<p><strong>介绍声音和音乐</strong></p>

<p><strong>使用不同的纹理</strong></p>

<p><strong>设置纹理属性</strong></p>

<p><strong>使用AndEngine字体资源</strong></p>

<p><strong>创建资源管理器</strong></p>

<p><strong>保存和装载游戏数据</strong></p>


  <address class="signature">
    <a class="author" href="/">lsj</a> 
    <span class="date">16 September 2014</span>
    <span class="location"></span>
  </address>
  
  
	<div class='cloud'>
		<a style='font-size: 170%' href='/tags.html#fms'>fms</a>
<a style='font-size: 70%' href='/tags.html#error'>error</a>
<a style='font-size: 157%' href='/tags.html#actionscript'>actionscript</a>
<a style='font-size: 70%' href='/tags.html#ios'>ios</a>
<a style='font-size: 131%' href='/tags.html#essential actionscript3.0'>essential actionscript3.0</a>
<a style='font-size: 70%' href='/tags.html#air'>air</a>
<a style='font-size: 112%' href='/tags.html#stock'>stock</a>
<a style='font-size: 70%' href='/tags.html#p2p'>p2p</a>
<a style='font-size: 112%' href='/tags.html#crack'>crack</a>
<a style='font-size: 70%' href='/tags.html#vim'>vim</a>
<a style='font-size: 112%' href='/tags.html#swf'>swf</a>
<a style='font-size: 70%' href='/tags.html#android'>android</a>

	</div>
	
  <div class="prev-next">
  
    <a href="/stock/2014/09/19/subscribe-new-stock" class="next" title="关于新股申购">Next Post &rarr;</a>
  
  
    <a href="/stock/2014/09/09/stock2" class="prev" title="股票入门之术语学习">&larr; Earlier Post</a>
  
  </div>
  
</div><!-- End Page -->

	




  <!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1926112"></script>
<!-- UY END -->





  
  <div id="footer">
  	<address>
  		<span class="copyright">
  			Content by <a href="/info/site.html">lsj</a>. Design by 
  			<a href="http://mark.reid.name/">Mark Reid</a>
  			<br/>
  			(<a rel="licence" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights reserved</a>)			
  		</span>
  		<span class="engine">
  			Powered by <a href="http://github.com/mojombo/jekyll/" title="A static, minimalist CMS">Jekyll</a>
  		</span>
  	</address>
  </div>
  
</div>



<!--[if IE 6]>
<script type="text/javascript"> 
	/*Load jQuery if not already loaded*/ if(typeof jQuery == 'undefined'){ document.write("<script type=\"text/javascript\"   src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js\"></"+"script>"); var __noconflict = true; } 
	var IE6UPDATE_OPTIONS = {
		icons_path: "http://static.ie6update.com/hosted/ie6update/images/"
	}
</script>
<script type="text/javascript" src="http://static.ie6update.com/hosted/ie6update/ie6update.js"></script>
<![endif]-->

  
  


<script type="text/javascript"> 
<!-- 
(function(){ 
var S=navigator.userAgent.indexOf("MSIE")!=-1&&!window.opera; 
function M(C){ 
return document.getElementById(C) 
} function R(C){ 
return document.createElement(C) 
} var P=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,28309,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42448,83315,21200,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46496,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,21952,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19415,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448]; 
var K="甲乙丙丁戊己庚辛壬癸"; 
var J="子丑寅卯辰巳午未申酉戌亥"; 
var O="鼠牛虎兔龙蛇马羊猴鸡狗猪"; 
var L=["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"]; 
var D=[0,21208,43467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758]; 
var B="日一二三四五六七八九十"; 
var H=["正","二","三","四","五","六","七","八","九","十","十一","腊"]; 
var E="初十廿卅"; 
var V={ 
"0101":"*1元旦节","0214":"情人节","0305":"学雷锋纪念日","0308":"妇女节","0312":"植树节","0315":"消费者权益日","0401":"愚人节","0501":"*1劳动节","0504":"青年节","0601":"国际儿童节","0701":"中国共产党诞辰","0801":"建军节","0910":"中国教师节","1001":"*3国庆节","1224":"平安夜","1225":"圣诞节" 
} ; 
var T={ 
"0101":"*2春节","0115":"元宵节","0505":"*1端午节","0815":"*1中秋节","0909":"重阳节","1208":"腊八节","0100":"除夕" 
} ; 
function U(Y){ 
function c(j,i){ 
var h=new Date((31556925974.7*(j-1900)+D[i]*60000)+Date.UTC(1900,0,6,2,5)); 
return(h.getUTCDate()) 
} function d(k){ 
var h,j=348; 
for(h=32768;h>8;h>>=1){ 
j+=(P[k-1900]&h)?1:0 
} return(j+b(k)) 
} function a(h){ 
return(K.charAt(h%10)+J.charAt(h%12)) 
} function b(h){ 
if(g(h)){ 
return((P[h-1900]&65536)?30:29) 
} else{ 
return(0) 
} 
} function g(h){ 
return(P[h-1900]&15) 
} function e(i,h){ 
return((P[i-1900]&(65536>>h))?30:29) 
} function C(m){ 
var k,j=0,h=0; 
var l=new Date(1900,0,31); 
var n=(m-l)/86400000; 
this.dayCyl=n+40; 
this.monCyl=14; 
for(k=1900;k<2050&&n>0;k++){ 
h=d(k); 
n-=h; 
this.monCyl+=12 
} if(n<0){ 
n+=h; 
k--; 
this.monCyl-=12 
} this.year=k; 
this.yearCyl=k-1864; 
j=g(k); 
this.isLeap=false; 
for(k=1;k<13&&n>0;k++){ 
if(j>0&&k==(j+1)&&this.isLeap==false){ 
--k; 
this.isLeap=true; 
h=b(this.year) 
} else{ 
h=e(this.year,k) 
} if(this.isLeap==true&&k==(j+1)){ 
this.isLeap=false 
} n-=h; 
if(this.isLeap==false){ 
this.monCyl++ 
} 
} if(n==0&&j>0&&k==j+1){ 
if(this.isLeap){ 
this.isLeap=false 
} else{ 
this.isLeap=true; 
--k; 
--this.monCyl 
} 
} if(n<0){ 
n+=h; 
--k; 
--this.monCyl 
} this.month=k; 
this.day=n+1 
} function G(h){ 
return h<10?"0"+h:h 
} function f(i,j){ 
var h=i; 
return j.replace(/dd?d?d?|MM?M?M?|yy?y?y?/g,function(k){ 
switch(k){ 
case"yyyy":var l="000"+h.getFullYear(); 
return l.substring(l.length-4); 
case"dd":return G(h.getDate()); 
case"d":return h.getDate().toString(); 
case"MM":return G((h.getMonth()+1)); 
case"M":return h.getMonth()+1 
} 
} ) 
} function Z(i,h){ 
var j; 
switch(i,h){ 
case 10:j="初十"; 
break; 
case 20:j="二十"; 
break; 
case 30:j="三十"; 
break; 
default:j=E.charAt(Math.floor(h/10)); 
j+=B.charAt(h%10) 
} return(j) 
} this.date=Y; 
this.isToday=false; 
this.isRestDay=false; 
this.solarYear=f(Y,"yyyy"); 
this.solarMonth=f(Y,"M"); 
this.solarDate=f(Y,"d"); 
this.solarWeekDay=Y.getDay(); 
this.solarWeekDayInChinese="星期"+B.charAt(this.solarWeekDay); 
var X=new C(Y); 
this.lunarYear=X.year; 
this.shengxiao=O.charAt((this.lunarYear-4)%12); 
this.lunarMonth=X.month; 
this.lunarIsLeapMonth=X.isLeap; 
this.lunarMonthInChinese=this.lunarIsLeapMonth?"闰"+H[X.month-1]:H[X.month-1]; 
this.lunarDate=X.day; 
this.showInLunar=this.lunarDateInChinese=Z(this.lunarMonth,this.lunarDate); 
if(this.lunarDate==1){ 
this.showInLunar=this.lunarMonthInChinese+"月" 
} this.ganzhiYear=a(X.yearCyl); 
this.ganzhiMonth=a(X.monCyl); 
this.ganzhiDate=a(X.dayCyl++); 
this.jieqi=""; 
this.restDays=0; 
if(c(this.solarYear,(this.solarMonth-1)*2)==f(Y,"d")){ 
this.showInLunar=this.jieqi=L[(this.solarMonth-1)*2] 
} if(c(this.solarYear,(this.solarMonth-1)*2+1)==f(Y,"d")){ 
this.showInLunar=this.jieqi=L[(this.solarMonth-1)*2+1] 
} if(this.showInLunar=="清明"){ 
this.showInLunar="清明节"; 
this.restDays=1 
} this.solarFestival=V[f(Y,"MM")+f(Y,"dd")]; 
if(typeof this.solarFestival=="undefined"){ 
this.solarFestival="" 
} else{ 
if(/\*(\d)/.test(this.solarFestival)){ 
this.restDays=parseInt(RegExp.$1); 
this.solarFestival=this.solarFestival.replace(/\*\d/,"") 
} 
} this.showInLunar=(this.solarFestival=="")?this.showInLunar:this.solarFestival; 
this.lunarFestival=T[this.lunarIsLeapMonth?"00":G(this.lunarMonth)+G(this.lunarDate)]; 
if(typeof this.lunarFestival=="undefined"){ 
this.lunarFestival="" 
} else{ 
if(/\*(\d)/.test(this.lunarFestival)){ 
this.restDays=(this.restDays>parseInt(RegExp.$1))?this.restDays:parseInt(RegExp.$1); 
this.lunarFestival=this.lunarFestival.replace(/\*\d/,"") 
} 
} if(this.lunarMonth==12&&this.lunarDate==e(this.lunarYear,12)){ 
this.lunarFestival=T["0100"]; 
this.restDays=1 
} this.showInLunar=(this.lunarFestival=="")?this.showInLunar:this.lunarFestival; 
this.showInLunar=(this.showInLunar.length>4)?this.showInLunar.substr(0,2)+"...":this.showInLunar 
} var Q=(function(){ 
var X={ 
} ; 
X.lines=0; 
X.dateArray=new Array(42); 
function Y(a){ 
return(((a%4===0)&&(a%100!==0))||(a%400===0)) 
} function G(a,b){ 
return[31,(Y(a)?29:28),31,30,31,30,31,31,30,31,30,31][b] 
} function C(a,b){ 
a.setDate(a.getDate()+b); 
return a 
} function Z(a){ 
var f=0; 
var c=new U(new Date(a.solarYear,a.solarMonth-1,1)); 
var d=(c.solarWeekDay-1==-1)?6:c.solarWeekDay-1; 
X.lines=Math.ceil((d+G(a.solarYear,a.solarMonth-1))/7); 
for(var e=0;e<X.dateArray.length;e++){ 
if(c.restDays!=0){ 
f=c.restDays 
} if(f>0){ 
c.isRest=true 
} if(d-->0||c.solarMonth!=a.solarMonth){ 
X.dateArray[e]=null; 
continue 
} var b=new U(new Date()); 
if(c.solarYear==b.solarYear&&c.solarMonth==b.solarMonth&&c.solarDate==b.solarDate){ 
c.isToday=true 
} X.dateArray[e]=c; 
c=new U(C(c.date,1)); 
f-- 
} 
} return{ 
init:function(a){ 
Z(a) 
} ,getJson:function(){ 
return X 
} 
} 
} )(); 
var W=(function(){ 
var C=M("top").getElementsByTagName("SELECT")[0]; 
var X=M("top").getElementsByTagName("SELECT")[1]; 
var G=M("top").getElementsByTagName("SPAN")[0]; 
var c=M("top").getElementsByTagName("SPAN")[1]; 
var Y=M("top").getElementsByTagName("INPUT")[0]; 
function a(g){ 
G.innerHTML=g.ganzhiYear; 
c.innerHTML=g.shengxiao 
} function b(g){ 
C[g.solarYear-1901].selected=true; 
X[g.solarMonth-1].selected=true 
} function f(){ 
var j=C.value; 
var g=X.value; 
var i=new U(new Date(j,g-1,1)); 
Q.init(i); 
N.draw(); 
if(this==C){ 
i=new U(new Date(j,3,1)); 
G.innerHTML=i.ganzhiYear; 
c.innerHTML=i.shengxiao 
} var h=new U(new Date()); 
Y.style.visibility=(j==h.solarYear&&g==h.solarMonth)?"hidden":"visible" 
} function Z(){ 
var g=new U(new Date()); 
a(g); 
b(g); 
Q.init(g); 
N.draw(); 
Y.style.visibility="hidden" 
} function d(k,g){ 
for(var j=1901;j<2050;j++){ 
var h=R("OPTION"); 
h.value=j; 
h.innerHTML=j; 
if(j==k){ 
h.selected="selected" 
} C.appendChild(h) 
} for(var j=1;j<13;j++){ 
var h=R("OPTION"); 
h.value=j; 
h.innerHTML=j; 
if(j==g){ 
h.selected="selected" 
} X.appendChild(h) 
} C.onchange=f; 
X.onchange=f 
} function e(g){ 
d(g.solarYear,g.solarMonth); 
G.innerHTML=g.ganzhiYear; 
c.innerHTML=g.shengxiao; 
Y.onclick=Z; 
Y.style.visibility="hidden" 
} return{ 
init:function(g){ 
e(g) 
} ,reset:function(g){ 
b(g) 
} 
} 
} )(); 
var N=(function(){ 
function C(){ 
var Z=Q.getJson(); 
var c=Z.dateArray; 
M("cm").style.height=Z.lines*38+2+"px"; 
M("cm").innerHTML=""; 
for(var a=0;a<c.length;a++){ 
if(c[a]==null){ 
continue 
} var X=R("DIV"); 
if(c[a].isToday){ 
X.style.border="1px solid #a5b9da"; 
X.style.background="#c1d9ff" 
} X.className="cell"; 
X.style.left=(a%7)*34+"px"; 
X.style.top=Math.floor(a/7)*38+2+"px"; 
var b=R("DIV"); 
b.className="so"; 
// http://www.codefans.net 
b.style.color=((a%7)>4||c[a].isRest)?"#c60b02":"#313131"; 
b.innerHTML=c[a].solarDate; 
X.appendChild(b); 
var Y=R("DIV"); 
Y.style.color="#666"; 
Y.innerHTML=c[a].showInLunar; 
X.appendChild(Y); 
X.onmouseover=(function(d){ 
return function(f){ 
F.show({ 
dateIndex:d,cell:this 
} ) 
} 
} )(a); 
X.onmouseout=function(){ 
F.hide() 
} ; 
M("cm").appendChild(X) 
} var G=R("DIV"); 
G.id="fd"; 
M("cm").appendChild(G); 
F.init(G) 
} return{ 
draw:function(G){ 
C(G) 
} 
} 
} )(); 
var F=(function(){ 
var C; 
function Y(e,c){ 
if(arguments.length>1){ 
var b=/([.*+?^=!:${}()|[\]\/\\])/g,Z="{".replace(b,"\\$1"),d="}".replace(b,"\\$1"); 
var a=new RegExp("#"+Z+"([^"+Z+d+"]+)"+d,"g"); 
if(typeof (c)=="object"){ 
return e.replace(a,function(f,h){ 
var g=c[h]; 
return typeof (g)=="undefined"?"":g 
} ) 
} 
} return e 
} function G(b){ 
var a=Q.getJson().dateArray[b.dateIndex]; 
var Z=b.cell; 
var c="#{solarYear} 年 #{solarMonth} 月 #{solarDate} 日 #{solarWeekDayInChinese}"; 
c+="<br><b> #{lunarMonthInChinese}月#{lunarDateInChinese}</b>"; 
c+="<br>#{ganzhiYear}年 #{ganzhiMonth}月 #{ganzhiDate}日"; 
if(a.solarFestival!=""||a.lunarFestival!=""||a.jieqi!=""){ 
c+="<br><b>#{lunarFestival} #{solarFestival} #{jieqi}</b>" 
} C.innerHTML=Y(c,a); 
C.style.top=Z.offsetTop+Z.offsetHeight-5+"px"; 
C.style.left=Z.offsetLeft+Z.offsetWidth-5+"px"; 
C.style.display="block" 
} function X(){ 
C.style.display="none" 
} return{ 
show:function(Z){ 
G(Z) 
} ,hide:function(){ 
X() 
} ,init:function(Z){ 
C=Z 
} 
} 
} )(); 
var A=new U(new Date()); 
if(S){ 
window.attachEvent("onload",function(){ 
W.reset(A) 
} ) 
} W.init(A); 
Q.init(A); 
N.draw(); 
} )(); 
//--> 
</script>
  
</body>
</html>

